---
// Dashboard component to present analysis result in cards
const props = Astro.props as { data?: any };
const data = props.data?.result || props.data || {};
---
<style>
  .dash-grid { display:grid; gap:1.1rem; grid-template-columns:repeat(auto-fill,minmax(230px,1fr)); margin-top:1.1rem; }
  .card { position:relative; border:1px solid rgba(255,255,255,.12); background:linear-gradient(140deg,rgba(255,255,255,.08),rgba(255,255,255,.02)); backdrop-filter:blur(18px) saturate(160%); padding:1rem 1.05rem 1.15rem; border-radius:18px; box-shadow:0 10px 40px -15px rgba(0,0,0,.55); overflow:hidden; }
  .card:before { content:""; position:absolute; inset:0; background:radial-gradient(circle at 130% -10%,rgba(255,255,255,.3),transparent 60%); opacity:.4; pointer-events:none; }
  .card h3 { margin:0 0 .5rem; font-size:.65rem; letter-spacing:1px; text-transform:uppercase; font-weight:600; background:linear-gradient(90deg,var(--grad-a),var(--grad-b)); -webkit-background-clip:text; color:transparent; }
  .metric { font-size:1.55rem; font-weight:600; line-height:1; }
  .score-ring { width:80px; height:80px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:600; font-size:1.35rem; margin:.25rem auto .55rem; background:conic-gradient(var(--col) calc(var(--p)*1%), #1e293b 0); position:relative; box-shadow:0 4px 14px -4px rgba(0,0,0,.6); }
  .score-ring::after { content:""; position:absolute; inset:7px; background:#0f172a; border-radius:50%; }
  .score-ring span { position:relative; z-index:1; }
  .bad { color:#f87171; }
  .warn { color:#fb923c; }
  .ok { color:#4ade80; }
  .notes { margin-top:1.8rem; }
  .notes li { font-size:.78rem; margin:.3rem 0; line-height:1.35; color:#b8cbe0; }
  .meta-block { margin-top:1.35rem; }
  pre.meta { max-height:210px; overflow:auto; font-size:.65rem; background:#020e1f; color:#e2e8f0; padding:.85rem .9rem; border-radius:14px; border:1px solid rgba(255,255,255,.08); }
  details summary { cursor:pointer; list-style:none; font-size:.65rem; letter-spacing:.5px; text-transform:uppercase; font-weight:600; color:#9fb3c9; }
  details[open] summary { color:#e2e8f0; }
  ::-webkit-scrollbar { width:10px; height:10px; }
  ::-webkit-scrollbar-track { background:transparent; }
  ::-webkit-scrollbar-thumb { background:#1e293b; border-radius:20px; border:2px solid #0f172a; }
</style>
<div>
  {data.url && <p style="font-size:.7rem; letter-spacing:.7px; text-transform:uppercase; color:#7ea6d6; margin:0 0 .4rem;">URL alvo: <strong style="color:#e2e8f0; text-transform:none; font-size:.75rem;">{data.url}</strong></p>}
  <div class="dash-grid">
    <div class="card" style="text-align:center; --p:{data.seoScore||0}; --col:{data.seoScore>=75?'#16a34a':data.seoScore>=50?'#d97706':'#dc2626'};">
      <h3>Score SEO</h3>
      <div class="score-ring"><span>{data.seoScore||0}</span></div>
      <div style="font-size:.7rem; text-transform:uppercase; letter-spacing:1px;">{data.seoScore>=75?'Bom':data.seoScore>=50?'Médio':'Atenção'}</div>
    </div>
    <div class="card"><h3>Links</h3><div class="metric">{data.linksFound||0}</div><div style="font-size:.7rem;">Internos {data.internalLinks||0} / Externos {data.externalLinks||0}</div></div>
    <div class="card"><h3>Quebrados</h3><div class="metric {data.brokenLinks? 'bad':''}">{data.brokenLinks||0}</div><div style="font-size:.7rem;">Amostra 40</div></div>
    <div class="card"><h3>Imagens</h3><div class="metric">{data.images||0}</div><div style="font-size:.7rem;">Sem alt {data.imagesMissingAlt||0}</div></div>
    <div class="card"><h3>Palavras</h3><div class="metric">{data.wordCount||0}</div><div style="font-size:.7rem;">H1 {data.h1Count||0}</div></div>
    <div class="card"><h3>Título</h3><div class="metric {(!data.title||data.titleLength<15||data.titleLength>65)?'warn':''}" style="font-size:1rem; word-break:break-word; max-height:3.4rem; overflow:hidden;">{data.title||'—'}</div><div style="font-size:.6rem;">{data.titleLength||0} chars</div></div>
    <div class="card"><h3>Descrição</h3><div class="metric {(!data.metaDescription||data.metaDescriptionLength<50||data.metaDescriptionLength>165)?'warn':''}" style="font-size:.7rem; max-height:3.9rem; overflow:hidden; line-height:1.2;">{data.metaDescription||'—'}</div><div style="font-size:.6rem;">{data.metaDescriptionLength||0} chars</div></div>
    <div class="card"><h3>Canonical</h3><div style="font-size:.6rem; word-break:break-all; line-height:1.2; max-height:4rem; overflow:auto;">{data.canonical||'—'}</div></div>
  </div>
  <div class="meta-block">
    <details>
      <summary>JSON bruto</summary>
      <pre class="meta">{JSON.stringify(data,null,2)}</pre>
    </details>
  </div>
  {data.notes && <div class="notes">
  <h3 style="font-size:.65rem; text-transform:uppercase; letter-spacing:1px; margin:1.5rem 0 .4rem; background:linear-gradient(90deg,var(--grad-b),var(--grad-a)); -webkit-background-clip:text; color:transparent;">Observações</h3>
    <ul>
      {data.notes.split(';').map((n: string) => <li>{n.trim()}</li>)}
    </ul>
  </div>}
</div>
