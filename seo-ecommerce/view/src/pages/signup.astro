---
export const prerender = false; // client-only signup
---
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <title>Cadastro</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="/theme.css" />
    <style>
      body { margin:0; min-height:100dvh; display:flex; align-items:center; justify-content:center; padding:2.4rem 1.2rem; }
      .auth-wrap { width:100%; max-width:520px; }
      h1 { margin:0 0 1.4rem; font-size:clamp(2rem,4.6vw,2.7rem); line-height:1.05; background:linear-gradient(90deg,var(--grad-a),var(--grad-b),var(--grad-c)); -webkit-background-clip:text; color:transparent; }
      .panel { position:relative; border:1px solid var(--color-border); background:var(--color-surface-glass); backdrop-filter:blur(30px) saturate(160%); padding:2rem 2.1rem 2.3rem; border-radius:34px; box-shadow:var(--shadow-card); }
      form { display:flex; flex-direction:column; gap:1rem; }
      label span { font-size:.7rem; letter-spacing:.6px; font-weight:600; text-transform:uppercase; color:var(--color-text-muted); }
      input { width:100%; padding:14px 16px; border:1px solid rgba(255,255,255,.14); border-radius:14px; background:#0f172a; color:var(--color-text); font-size:.9rem; font-family:inherit; }
      input:focus { outline:2px solid var(--grad-b); outline-offset:2px; border-color:var(--grad-b); }
      .btn-submit { all:unset; cursor:pointer; text-align:center; padding:15px 22px; border-radius:16px; font-weight:600; font-size:.9rem; background:linear-gradient(90deg,var(--grad-b),var(--grad-a),var(--grad-c)); box-shadow:0 10px 34px -14px rgba(126,34,206,.55); }
      .btn-submit:hover { transform:translateY(-2px); }
      .meta { margin-top:1rem; font-size:.75rem; color:var(--color-text-muted); }
      .meta a { color:var(--grad-a); text-decoration:none; }
      .alert { padding:.85rem 1rem; border-radius:16px; font-size:.8rem; line-height:1.35; margin:-.35rem 0 1.1rem; font-weight:500; }
      .alert.err { background:rgba(220,38,38,.12); border:1px solid rgba(220,38,38,.4); color:#fecaca; }
      .alert.info { background:rgba(34,197,94,.12); border:1px solid rgba(34,197,94,.5); color:#bbf7d0; }
      nav { position:absolute; top:1rem; right:1.2rem; font-size:.65rem; letter-spacing:.5px; text-transform:uppercase; display:flex; gap:.9rem; }
      nav a { color:var(--color-text-soft); text-decoration:none; font-weight:600; opacity:.85; }
      nav a:hover { opacity:1; }
    </style>
  </head>
  <body>
  <a href="#main" class="skip-link">Pular para conteúdo</a>
  <div class="auth-wrap" id="main" role="main">
      <div class="panel">
        <nav>
          <a href="/">Home</a>
          <a href="/analise">Painel</a>
          <a href="https://seo-ecommercex.deco.page/tools/link-analyzer/" target="_blank" rel="noopener">Docs</a>
          <a href="/perfil" id="perfil-link" style="display:none">Perfil</a>
          <button id="logout-nav" style="display:none;all:unset;cursor:pointer;font-size:.65rem;text-transform:uppercase;letter-spacing:.5px;color:#b8cbe0;font-weight:600;">Sair</button>
        </nav>
  <h1>Criar conta</h1>
  <div id="signup-alert" class="alert err" style="display:none"></div>
  <form id="signup-form" aria-describedby="signup-desc" novalidate>
          <p id="signup-desc" class="visually-hidden">Criar nova conta para habilitar histórico e painel de análises.</p>
          <label>
            <span>Email</span>
            <input name="email" type="email" required autocomplete="email" />
          </label>
          <label>
            <span>Senha</span>
            <input name="password" type="password" required minlength="6" autocomplete="new-password" />
          </label>
            <button type="submit" class="btn-submit">Criar conta</button>
          <div class="meta">Já possui conta? <a href="/login">Login</a></div>
        </form>
      </div>
    </div>
  <script>(function(){const f=document.getElementById('signup-form');if(f){f.addEventListener('submit',e=>e.preventDefault(),{passive:false});}})();</script>
    <script type="module">
      (async ()=>{
        const alertBox = document.getElementById('signup-alert');
        function show(msg){ if(alertBox){ alertBox.textContent=msg; alertBox.style.display='block'; } else { alert(msg); } }
        // Redirect se já logado
        try {
          const existing = localStorage.getItem('la-supa-auth');
          if(existing){
            const params = new URLSearchParams(location.search); const next=params.get('next');
            location.replace(next || '/analise');
            return;
          }
        } catch {}
  let supa; try { const { loadSupabase } = await import('../lib/supabaseClient.ts'); supa = await loadSupabase(); console.log('[signup] Cliente Supabase via util'); } catch(e){ console.error('[signup] init erro', e); show('Auth indisponível'); return; }
        const formEl = document.getElementById('signup-form');
        if(!formEl){ show('Formulário não encontrado'); return; }
        formEl.addEventListener('submit', async (e)=>{ e.preventDefault();
          alertBox.style.display='none';
          const fd = new FormData(formEl);
          const email = fd.get('email')?.toString() || '';
          const password = fd.get('password')?.toString() || '';
          if(!email || !password){ show('Informe email e senha'); return; }
          console.log('[signup] Tentando signUp', { email });
          try{
            const { data, error } = await supa.auth.signUp({ email, password });
            console.log('[signup] Resposta signUp', { error, user: !!data?.user });
            if(error){ show(error.message || 'Erro ao cadastrar'); return; }
            // Se confirmação de email estiver habilitada, sessão pode não vir imediatamente
            if(!data?.session){ console.log('[signup] Sem sessão imediata (confirmação?)'); }
            try{ localStorage.setItem('la-user', JSON.stringify({ email })); }catch{}
            const params = new URLSearchParams(location.search); const next = params.get('next');
            if(next){ location.replace(next); } else { location.href = '/analise'; }
          }catch(err){ console.error('[signup] Exceção signUp', err); show('Erro ao cadastrar'); }
        });
      })();
    </script>
    <script>
  (function(){
    const authRaw = localStorage.getItem('la-supa-auth');
    const perfilLink = document.getElementById('perfil-link');
    const logoutBtn = document.getElementById('logout-nav');
    if(!authRaw){
      if(perfilLink) perfilLink.style.display='none';
      if(logoutBtn) logoutBtn.style.display='none';
      return;
    }
    try {
      perfilLink && (perfilLink.style.display='inline');
      if (logoutBtn){
        logoutBtn.style.display='inline';
        logoutBtn.addEventListener('click',()=>{ localStorage.removeItem('la-supa-auth'); localStorage.removeItem('la-user'); location.href='/'; });
      }
    } catch {}
  })();
</script>
  </body>
</html>
