---
title: Default Project Structure
description: Understand how a Deco App is organized with server and view components
icon: Folder
---

import Callout from "../../components/ui/Callout.astro";

```
my-mcp-project/
├── package.json          # Root workspace scripts (dev, gen, deploy)
├── tsconfig.json         # TypeScript configuration
├── server/               # MCP Server (Cloudflare Worker)
│   ├── main.ts          # Server entry point - imports tools/workflows/views
│   ├── tools/           # Tool definitions organized by domain
│   │   ├── index.ts     # Central export for all tools
│   │   ├── todos.ts     # Todo-related tools
│   │   └── user.ts      # User-related tools
│   ├── workflows/       # Workflow definitions organized by domain
│   │   └── index.ts     # Central export for all workflows
│   ├── views.ts         # View configurations
│   ├── schema.ts        # Database schema (Drizzle ORM)
│   ├── db.ts            # Database connection helper
│   ├── drizzle.config.ts # Drizzle configuration
│   ├── deco.gen.ts      # Generated types for integrations
│   ├── drizzle/         # Migration files
│   └── package.json     # Server dependencies
└── view/                # React App (Vite + TanStack Router)
    ├── src/
    │   ├── main.tsx     # App entry point with router setup
    │   ├── routes/      # Page components
    │   │   └── home.tsx # Homepage route
    │   ├── components/  # Reusable UI components
    │   │   ├── ui/      # shadcn/ui components
    │   │   ├── error-boundary.tsx
    │   │   ├── user-button.tsx
    │   │   └── logged-provider.tsx
    │   ├── hooks/       # Custom React hooks
    │   │   └── useToolCalls.ts
    │   ├── lib/         # RPC client and utilities
    │   │   ├── rpc.ts   # Standard RPC client
    │   │   ├── rpc-logged.ts # Logged RPC client
    │   │   ├── hooks.ts # Utility hooks
    │   │   └── utils.ts # General utilities
    │   └── styles.css   # Tailwind CSS styles
    ├── public/          # Static assets
    ├── vite.config.ts   # Vite configuration
    ├── components.json  # shadcn/ui configuration
    └── package.json     # Frontend dependencies
```

## Server (`/server`)

Your MCP server runs as a Cloudflare Worker and exposes tools and workflows.

### `main.ts` - Core Server Logic

The main entry point imports from organized directories:

```typescript
import { DefaultEnv, withRuntime } from "@deco/workers-runtime";
import { type Env as DecoEnv, StateSchema } from "./deco.gen.ts";

import { workflows } from "./workflows/index.ts";
import { tools } from "./tools/index.ts";
import { views } from "./views.ts";

export type Env = DefaultEnv & DecoEnv & {
  ASSETS: {
    fetch: (request: Request) => Promise<Response>;
  };
};

const runtime = withRuntime<Env, typeof StateSchema>({
  oauth: {
    scopes: ["AI_GENERATE", "AI_GENERATE_OBJECT"],
    state: StateSchema,
  },
  views,
  workflows,
  tools,
  fetch: fallbackToView("/"), // Serves React app assets
});

export const Workflow = runtime.Workflow;
export default runtime;
```

#### Understanding OAuth Scopes

The `scopes` array defines the permissions your app requests when users install it:

- **`AI_GENERATE`**: Allows your app to use the user's AI Gateway for text generation
- **`AI_GENERATE_OBJECT`**: Enables structured object generation using the user's AI models

When users authorize these scopes, you can access `env.DECO_CHAT_WORKSPACE_API.AI_GENERATE` 
and similar methods without deploying your own AI infrastructure or managing API keys.

#### Understanding State Schema

The `StateSchema` defines the configuration form users see when installing your app. 
This enables multi-tenant functionality where different users can have different configurations 
for the same app.

The state schema is automatically generated from your app's binding dependencies. 
You can extend it to add custom fields:

```typescript
// Example: Extending state schema for API keys
import { StateSchema as BaseSchema } from "./deco.gen.ts";

const ExtendedSchema = BaseSchema.extend({
  apiKey: z.string().describe("Your third-party API key"),
  environment: z.enum(["development", "production"]).default("development"),
});
```

Users fill out this form during installation, and the values are available in 
your `env.DECO_REQUEST_CONTEXT.state` object throughout your application.

### `tools/` - Tool Definitions

Tools are now organized by domain in separate files with a central export:

#### `tools/index.ts` - Central Tool Export
```typescript
import { todoTools } from "./todos.ts";
import { userTools } from "./user.ts";

// Export all tools from all domains
export const tools = [
  ...todoTools,
  ...userTools,
];

// Re-export domain-specific tools for direct access if needed
export { todoTools } from "./todos.ts";
export { userTools } from "./user.ts";
```

#### `tools/todos.ts` - Todo Domain Tools
```typescript
import { createTool } from "@deco/workers-runtime/mastra";

export const createListTodosTool = (env: Env) =>
  createTool({
    id: "LIST_TODOS",
    description: "List all todos",
    inputSchema: z.object({}),
    outputSchema: z.object({
      todos: z.array(z.object({
        id: z.number(),
        title: z.string().nullable(),
        completed: z.boolean(),
      })),
    }),
    execute: async () => {
      const db = await getDb(env);
      const todos = await db.select().from(todosTable);
      return { todos };
    },
  });

export const todoTools = [
  createListTodosTool,
  // ... other todo tools
];
```

### `workflows/` - Workflow Definitions

Workflows are organized by domain with a central export:

#### `workflows/index.ts` - Central Workflow Export
```typescript
// Import workflow arrays from domain files
// import { todoWorkflows } from "./todos.ts";
// import { userWorkflows } from "./user.ts";

// Export all workflows from all domains
export const workflows = [
  // ...todoWorkflows,
  // ...userWorkflows,
];

// Re-export domain-specific workflows for direct access if needed
// export { todoWorkflows } from "./todos.ts";
// export { userWorkflows } from "./user.ts";
```

#### Domain-specific Workflow Files
When you add workflows, create domain files like `workflows/todos.ts`:

```typescript
import { createWorkflow, createStepFromTool } from "@deco/workers-runtime/mastra";

const createMyWorkflow = (env: Env) => {
  const step = createStepFromTool(createMyTool(env));
  
  return createWorkflow({
    id: "MY_WORKFLOW",
    inputSchema: z.object({ name: z.string() }),
    outputSchema: z.object({ message: z.string() }),
  })
    .then(step)
    .commit();
};

export const todoWorkflows = [createMyWorkflow];
```

### `views.ts` - View Configurations

External React apps that can be installed with your MCP:

```typescript
export const views = () => [
  {
    title: "My App",
    icon: "dashboard",
    url: "https://my-app.deco.page",
  },
];
```

### `deco.gen.ts` - Generated Types

Auto-generated TypeScript types for integrations. **Never edit manually.**

```bash
# Regenerate after adding integrations
npm run gen

# Generate types for your own tools
npm run gen:self
```

### `schema.ts` - Database Schema

Define your database tables using Drizzle ORM:

```typescript
import { integer, sqliteTable, text } from "@deco/workers-runtime/drizzle";

export const todosTable = sqliteTable("todos", {
  id: integer("id").primaryKey(),
  title: text("title"),
  completed: integer("completed").default(0),
});
```

### `db.ts` - Database Helper

Database connection helper:

```typescript
import { getDatabase } from "@deco/workers-runtime/drizzle";
import type { Env } from "./main.ts";
import * as schema from "./schema.ts";

export const getDb = (env: Env) => getDatabase(env, schema);
```

### `wrangler.toml` - Configuration

Cloudflare Workers configuration:

```toml
name = "my-mcp-project"
main = "main.ts"
compatibility_date = "2025-06-17"
compatibility_flags = ["nodejs_compat"]

[assets]
directory = "./view-build"
binding = "ASSETS"

[deco]
workspace = "deco.cx"
bindings = []
enable_workflows = true

[durable_objects]
[[durable_objects.bindings]]
name = "DECO_CHAT_WORKFLOW_DO"
class_name = "Workflow"
```

<Callout type="info">
  Integrations added via `deco add` automatically update this file.
</Callout>

## View (`/view`)

The view directory contains a React app built with Vite and TanStack Router.

### App Structure

```
view/src/
├── main.tsx            # App entry point with router setup
├── routes/             # Page components
│   └── home.tsx       # Homepage route
├── components/         # Reusable UI components
│   ├── ui/            # shadcn/ui components
│   ├── error-boundary.tsx
│   ├── user-button.tsx
│   └── logged-provider.tsx
├── hooks/             # Custom React hooks
│   └── useToolCalls.ts
├── lib/               # RPC client and utilities
│   ├── rpc.ts         # Standard RPC client
│   ├── rpc-logged.ts  # Logged RPC client
│   ├── hooks.ts       # Utility hooks
│   └── utils.ts       # General utilities
└── styles.css         # Tailwind CSS styles
```

### RPC Client

The view provides multiple RPC clients for different use cases:

#### Standard RPC Client
```typescript
// view/src/lib/rpc.ts
import { createClient } from "@deco/workers-runtime/client";
import type { Env } from "../../server/deco.gen.ts";

type SelfMCP = Env["SELF"];
export const client = createClient<SelfMCP>();
```

#### Logged RPC Client
For debugging and monitoring tool calls:
```typescript
// view/src/lib/rpc-logged.ts
import { createLoggedClient } from "@deco/workers-runtime/client";
import type { Env } from "../../server/deco.gen.ts";

type SelfMCP = Env["SELF"];
export const loggedClient = createLoggedClient<SelfMCP>();
```

### Route Components

Create pages using TanStack Router:

```typescript
// view/src/routes/home.tsx
import { createRoute } from "@tanstack/react-router";
import { client } from "../lib/rpc";

export default (parentRoute) => createRoute({
  getParentRoute: () => parentRoute,
  path: "/",
  component: HomePage,
});

function HomePage() {
  const handleListTodos = async () => {
    const todos = await client.tools.LIST_TODOS({});
    console.log(todos);
  };

  return (
    <div>
      <h1>My App</h1>
      <button onClick={handleListTodos}>Load Todos</button>
    </div>
  );
}
```

### Custom Hooks

The new structure includes a dedicated hooks directory:

```typescript
// view/src/hooks/useToolCalls.ts
import { useState, useCallback } from "react";
import { client } from "../lib/rpc";

export function useToolCalls() {
  const [loading, setLoading] = useState(false);
  
  const callTool = useCallback(async (toolId: string, params: any) => {
    setLoading(true);
    try {
      const result = await client.tools[toolId](params);
      return result;
    } finally {
      setLoading(false);
    }
  }, []);
  
  return { callTool, loading };
}
```


### What Gets Deployed

- **MCP Server**: Available at `/mcp` endpoint for AI agents
- **React App**: Public web interface for your tools
- **Database**: SQLite database with isolated workspace data  
- **Integrations**: OAuth tokens and API credentials (encrypted)

<Callout type="warning">
  React apps are public by default. Add authentication for private features.
</Callout>
