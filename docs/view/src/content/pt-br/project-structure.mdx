---
title: Estrutura Padrão do Projeto
description: Entenda como um App Deco é organizado com componentes de servidor e visualização
icon: Folder
---

import Callout from "../../components/ui/Callout.astro";

```
meu-projeto-mcp/
├── package.json          # Scripts do workspace raiz (dev, gen, deploy)
├── tsconfig.json         # Configuração do TypeScript
├── server/               # Servidor MCP (Cloudflare Worker)
│   ├── main.ts          # Ponto de entrada do servidor - importa tools/workflows/views
│   ├── tools/           # Definições de ferramentas organizadas por domínio
│   │   ├── index.ts     # Exportação central para todas as ferramentas
│   │   ├── todos.ts     # Ferramentas relacionadas a tarefas
│   │   └── user.ts      # Ferramentas relacionadas ao usuário
│   ├── workflows/       # Definições de fluxos de trabalho organizadas por domínio
│   │   └── index.ts     # Exportação central para todos os fluxos de trabalho
│   ├── views.ts         # Configurações de visualização
│   ├── schema.ts        # Schema do banco de dados (Drizzle ORM)
│   ├── db.ts            # Helper de conexão do banco de dados
│   ├── drizzle.config.ts # Configuração do Drizzle
│   ├── deco.gen.ts      # Tipos gerados para integrações
│   ├── drizzle/         # Arquivos de migração
│   └── package.json     # Dependências do servidor
└── view/                # App React (Vite + TanStack Router)
    ├── src/
    │   ├── main.tsx     # Ponto de entrada do app com configuração do roteador
    │   ├── routes/      # Componentes de página
    │   │   └── home.tsx # Rota da homepage
    │   ├── components/  # Componentes de UI reutilizáveis
    │   │   ├── ui/      # Componentes shadcn/ui
    │   │   ├── error-boundary.tsx
    │   │   ├── user-button.tsx
    │   │   └── logged-provider.tsx
    │   ├── hooks/       # Hooks customizados do React
    │   │   └── useToolCalls.ts
    │   ├── lib/         # Cliente RPC e utilitários
    │   │   ├── rpc.ts   # Cliente RPC padrão
    │   │   ├── rpc-logged.ts # Cliente RPC com log
    │   │   ├── hooks.ts # Hooks utilitários
    │   │   └── utils.ts # Utilitários gerais
    │   └── styles.css   # Estilos Tailwind CSS
    ├── public/          # Assets estáticos
    ├── vite.config.ts   # Configuração do Vite
    ├── components.json  # Configuração shadcn/ui
    └── package.json     # Dependências do frontend
```

## Servidor (`/server`)

Seu servidor MCP roda como um Cloudflare Worker e expõe ferramentas e fluxos de trabalho.

### `main.ts` - Lógica Central do Servidor

O ponto de entrada principal importa de diretórios organizados:

```typescript
import { DefaultEnv, withRuntime } from "@deco/workers-runtime";
import { type Env as DecoEnv, StateSchema } from "./deco.gen.ts";

import { workflows } from "./workflows/index.ts";
import { tools } from "./tools/index.ts";
import { views } from "./views.ts";

export type Env = DefaultEnv & DecoEnv & {
  ASSETS: {
    fetch: (request: Request) => Promise<Response>;
  };
};

const runtime = withRuntime<Env, typeof StateSchema>({
  oauth: {
    scopes: ["AI_GENERATE", "AI_GENERATE_OBJECT"],
    state: StateSchema,
  },
  views,
  workflows,
  tools,
  fetch: fallbackToView("/"), // Serve assets do app React
});

export const Workflow = runtime.Workflow;
export default runtime;
```

#### Entendendo Escopos OAuth

O array `scopes` define as permissões que seu app solicita quando os usuários o instalam:

- **`AI_GENERATE`**: Permite que seu app use o AI Gateway do usuário para geração de texto
- **`AI_GENERATE_OBJECT`**: Habilita geração estruturada de objetos usando os modelos de IA do usuário

Quando os usuários autorizam esses escopos, você pode acessar `env.DECO_CHAT_WORKSPACE_API.AI_GENERATE` 
e métodos similares sem implantar sua própria infraestrutura de IA ou gerenciar chaves de API.

#### Entendendo State Schema

O `StateSchema` define o formulário de configuração que os usuários veem ao instalar seu app. 
Isso habilita funcionalidade multi-tenant onde diferentes usuários podem ter configurações diferentes 
para o mesmo app.

O state schema é automaticamente gerado das dependências de binding do seu app. 
Você pode estendê-lo para adicionar campos customizados:

```typescript
// Exemplo: Estendendo state schema para chaves de API
import { StateSchema as BaseSchema } from "./deco.gen.ts";

const ExtendedSchema = BaseSchema.extend({
  apiKey: z.string().describe("Sua chave de API de terceiros"),
  environment: z.enum(["development", "production"]).default("development"),
});
```

Os usuários preenchem este formulário durante a instalação, e os valores estão disponíveis em 
seu objeto `env.DECO_REQUEST_CONTEXT.state` através de sua aplicação.

### `tools/` - Definições de Ferramentas

Ferramentas agora são organizadas por domínio em arquivos separados com uma exportação central:

#### `tools/index.ts` - Exportação Central de Ferramentas
```typescript
import { todoTools } from "./todos.ts";
import { userTools } from "./user.ts";

// Exportar todas as ferramentas de todos os domínios
export const tools = [
  ...todoTools,
  ...userTools,
];

// Re-exportar ferramentas específicas do domínio para acesso direto se necessário
export { todoTools } from "./todos.ts";
export { userTools } from "./user.ts";
```

#### `tools/todos.ts` - Ferramentas do Domínio Todo
```typescript
import { createTool } from "@deco/workers-runtime/mastra";

export const createListTodosTool = (env: Env) =>
  createTool({
    id: "LIST_TODOS",
    description: "Listar todas as tarefas",
    inputSchema: z.object({}),
    outputSchema: z.object({
      todos: z.array(z.object({
        id: z.number(),
        title: z.string().nullable(),
        completed: z.boolean(),
      })),
    }),
    execute: async () => {
      const db = await getDb(env);
      const todos = await db.select().from(todosTable);
      return { todos };
    },
  });

export const todoTools = [
  createListTodosTool,
  // ... outras ferramentas de todo
];
```

### `workflows/` - Definições de Fluxos de Trabalho

Fluxos de trabalho são organizados por domínio com uma exportação central:

#### `workflows/index.ts` - Exportação Central de Fluxos de Trabalho
```typescript
// Importar arrays de workflow de arquivos de domínio
// import { todoWorkflows } from "./todos.ts";
// import { userWorkflows } from "./user.ts";

// Exportar todos os workflows de todos os domínios
export const workflows = [
  // ...todoWorkflows,
  // ...userWorkflows,
];

// Re-exportar workflows específicos do domínio para acesso direto se necessário
// export { todoWorkflows } from "./todos.ts";
// export { userWorkflows } from "./user.ts";
```

#### Arquivos de Workflow Específicos do Domínio
Quando você adicionar workflows, crie arquivos de domínio como `workflows/todos.ts`:

```typescript
import { createWorkflow, createStepFromTool } from "@deco/workers-runtime/mastra";

const createMyWorkflow = (env: Env) => {
  const step = createStepFromTool(createMyTool(env));
  
  return createWorkflow({
    id: "MY_WORKFLOW",
    inputSchema: z.object({ name: z.string() }),
    outputSchema: z.object({ message: z.string() }),
  })
    .then(step)
    .commit();
};

export const todoWorkflows = [createMyWorkflow];
```

### `views.ts` - Configurações de Visualização

Apps React externos que podem ser instalados com seu MCP:

```typescript
export const views = () => [
  {
    title: "Meu App",
    icon: "dashboard",
    url: "https://meu-app.deco.page",
  },
];
```

### `deco.gen.ts` - Tipos Gerados

Tipos TypeScript auto-gerados para integrações. **Nunca edite manualmente.**

```bash
# Regenerar após adicionar integrações
npm run gen

# Gerar tipos para suas próprias ferramentas
npm run gen:self
```

### `schema.ts` - Schema do Banco de Dados

Defina suas tabelas de banco de dados usando Drizzle ORM:

```typescript
import { integer, sqliteTable, text } from "@deco/workers-runtime/drizzle";

export const todosTable = sqliteTable("todos", {
  id: integer("id").primaryKey(),
  title: text("title"),
  completed: integer("completed").default(0),
});
```

### `db.ts` - Helper do Banco de Dados

Helper de conexão do banco de dados:

```typescript
import { getDatabase } from "@deco/workers-runtime/drizzle";
import type { Env } from "./main.ts";
import * as schema from "./schema.ts";

export const getDb = (env: Env) => getDatabase(env, schema);
```

### `wrangler.toml` - Configuração

Configuração do Cloudflare Workers:

```toml
name = "meu-projeto-mcp"
main = "main.ts"
compatibility_date = "2025-06-17"
compatibility_flags = ["nodejs_compat"]

[assets]
directory = "./view-build"
binding = "ASSETS"

[deco]
workspace = "deco.cx"
bindings = []
enable_workflows = true

[durable_objects]
[[durable_objects.bindings]]
name = "DECO_CHAT_WORKFLOW_DO"
class_name = "Workflow"
```

<Callout type="info">
  Integrações adicionadas via `deco add` atualizam automaticamente este arquivo.
</Callout>

## View (`/view`)

O diretório view contém um app React construído com Vite e TanStack Router.

### Estrutura do App

```
view/src/
├── main.tsx            # Ponto de entrada do app com configuração do roteador
├── routes/             # Componentes de página
│   └── home.tsx       # Rota da homepage
├── components/         # Componentes de UI reutilizáveis
│   ├── ui/            # Componentes shadcn/ui
│   ├── error-boundary.tsx
│   ├── user-button.tsx
│   └── logged-provider.tsx
├── hooks/             # Hooks customizados do React
│   └── useToolCalls.ts
├── lib/               # Cliente RPC e utilitários
│   ├── rpc.ts         # Cliente RPC padrão
│   ├── rpc-logged.ts  # Cliente RPC com log
│   ├── hooks.ts       # Hooks utilitários
│   └── utils.ts       # Utilitários gerais
└── styles.css         # Estilos Tailwind CSS
```

### Cliente RPC

A view fornece múltiplos clientes RPC para diferentes casos de uso:

#### Cliente RPC Padrão
```typescript
// view/src/lib/rpc.ts
import { createClient } from "@deco/workers-runtime/client";
import type { Env } from "../../server/deco.gen.ts";

type SelfMCP = Env["SELF"];
export const client = createClient<SelfMCP>();
```

#### Cliente RPC com Log
Para debugging e monitoramento de chamadas de ferramentas:
```typescript
// view/src/lib/rpc-logged.ts
import { createLoggedClient } from "@deco/workers-runtime/client";
import type { Env } from "../../server/deco.gen.ts";

type SelfMCP = Env["SELF"];
export const loggedClient = createLoggedClient<SelfMCP>();
```

### Componentes de Rota

Crie páginas usando TanStack Router:

```typescript
// view/src/routes/home.tsx
import { createRoute } from "@tanstack/react-router";
import { client } from "../lib/rpc";

export default (parentRoute) => createRoute({
  getParentRoute: () => parentRoute,
  path: "/",
  component: HomePage,
});

function HomePage() {
  const handleListTodos = async () => {
    const todos = await client.tools.LIST_TODOS({});
    console.log(todos);
  };

  return (
    <div>
      <h1>Meu App</h1>
      <button onClick={handleListTodos}>Carregar Tarefas</button>
    </div>
  );
}
```

### Hooks Customizados

A nova estrutura inclui um diretório dedicado para hooks:

```typescript
// view/src/hooks/useToolCalls.ts
import { useState, useCallback } from "react";
import { client } from "../lib/rpc";

export function useToolCalls() {
  const [loading, setLoading] = useState(false);
  
  const callTool = useCallback(async (toolId: string, params: any) => {
    setLoading(true);
    try {
      const result = await client.tools[toolId](params);
      return result;
    } finally {
      setLoading(false);
    }
  }, []);
  
  return { callTool, loading };
}
```


### O Que é Implantado

- **Servidor MCP**: Disponível no endpoint `/mcp` para agentes de IA
- **App React**: Interface web pública para suas ferramentas
- **Banco de Dados**: Banco de dados SQLite com dados isolados por workspace  
- **Integrações**: Tokens OAuth e credenciais de API (criptografados)

<Callout type="warning">
  Apps React são públicos por padrão. Adicione autenticação para recursos privados.
</Callout>