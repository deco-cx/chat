---
title: Estrutura do Projeto
description: Entenda como servidores MCP são organizados com componentes server e view
icon: Folder
---

import Callout from "../../components/ui/Callout.astro";

```
my-mcp-project/
├── package.json          # Scripts do workspace root (dev, gen, deploy)
├── tsconfig.json         # Configuração TypeScript
├── server/               # Servidor MCP (Cloudflare Worker)
│   ├── main.ts          # Entry point do servidor - importa tools/workflows/views
│   ├── tools.ts         # Definições de tools
│   ├── workflows.ts     # Definições de workflows
│   ├── views.ts         # Configurações de views
│   ├── schema.ts        # Schema do banco de dados (Drizzle ORM)
│   ├── db.ts            # Helper de conexão do banco
│   ├── drizzle.config.ts # Configuração Drizzle
│   ├── deco.gen.ts      # Tipos gerados para integrações
│   ├── wrangler.toml    # Configuração Cloudflare & bindings
│   ├── drizzle/         # Arquivos de migração
│   │   ├── migrations.js
│   │   └── *.sql
│   └── package.json     # Dependências do servidor
└── view/                # App React (Vite + TanStack Router)
    ├── src/
    │   ├── main.tsx     # Entry point do app com setup do router
    │   ├── routes/      # Componentes de página (home.tsx, profile.tsx)
    │   ├── components/  # Componentes UI reutilizáveis
    │   ├── lib/         # Cliente RPC e utilitários
    │   └── styles.css   # Estilos Tailwind CSS
    ├── public/          # Assets estáticos
    ├── vite.config.ts   # Configuração Vite
    ├── components.json  # Configuração shadcn/ui
    └── package.json     # Dependências frontend

```

## Server (`/server`)

Seu servidor MCP roda como um Cloudflare Worker e expõe tools e workflows.

### `main.ts` - Lógica Principal do Servidor

O entry point principal importa de arquivos separados para organização:

```typescript
import { withRuntime } from "@deco/workers-runtime";
import { tools } from "./tools.ts";
import { workflows } from "./workflows.ts";
import { views } from "./views.ts";

const runtime = withRuntime<Env, typeof StateSchema>({
  oauth: {
    scopes: ["AI_GENERATE", "AI_GENERATE_OBJECT"],
    state: StateSchema,
  },
  views,
  workflows,
  tools,
  fetch: fallbackToView("/"), // Serves React app assets
});

export const Workflow = runtime.Workflow;
export default runtime;
```

### `tools.ts` - Definições de Tools

Todas as suas tools em um arquivo organizado:

```typescript
import { createTool, createPrivateTool } from "@deco/workers-runtime/mastra";

export const createListTodosTool = (env: Env) =>
  createTool({
    id: "LIST_TODOS",
    description: "List all todos",
    inputSchema: z.object({}),
    outputSchema: z.object({
      todos: z.array(z.object({
        id: z.number(),
        title: z.string().nullable(),
        completed: z.boolean(),
      })),
    }),
    execute: async () => {
      const db = await getDb(env);
      const todos = await db.select().from(todosTable);
      return { todos };
    },
  });

export const tools = [
  createListTodosTool,
  // ... other tools
];
```

### `workflows.ts` - Definições de Workflows

Processos complexos de múltiplos passos:

```typescript
import { createWorkflow, createStepFromTool } from "@deco/workers-runtime/mastra";

const createMyWorkflow = (env: Env) => {
  const step = createStepFromTool(createMyTool(env));
  
  return createWorkflow({
    id: "MY_WORKFLOW",
    inputSchema: z.object({ name: z.string() }),
    outputSchema: z.object({ message: z.string() }),
  })
    .then(step)
    .commit();
};

export const workflows = [createMyWorkflow];
```

### `views.ts` - Configurações de Views

Apps React externos que podem ser instalados com seu MCP:

```typescript
export const views = () => [
  {
    title: "My App",
    icon: "dashboard",
    url: "https://my-app.deco.page",
  },
];
```

### `deco.gen.ts` - Tipos Gerados

Tipos TypeScript auto-gerados para integrações. **Nunca edite manualmente.**

```bash
# Regenerar após adicionar integrações
npm run gen

# Gerar tipos para suas próprias tools
npm run gen:self
```

### `schema.ts` - Schema do Banco de Dados

Defina suas tabelas do banco usando Drizzle ORM:

```typescript
import { integer, sqliteTable, text } from "@deco/workers-runtime/drizzle";

export const todosTable = sqliteTable("todos", {
  id: integer("id").primaryKey(),
  title: text("title"),
  completed: integer("completed").default(0),
});
```

### `db.ts` - Helper do Banco

Helper de conexão do banco de dados:

```typescript
import { getDatabase } from "@deco/workers-runtime/drizzle";
import type { Env } from "./main.ts";
import * as schema from "./schema.ts";

export const getDb = (env: Env) => getDatabase(env, schema);
```

### `wrangler.toml` - Configuração

Configuração do Cloudflare Workers:

```toml
name = "my-mcp-project"
main = "main.ts"
compatibility_date = "2025-06-17"
compatibility_flags = ["nodejs_compat"]

[assets]
directory = "./view-build"
binding = "ASSETS"

[deco]
workspace = "deco.cx"
bindings = []
enable_workflows = true

[durable_objects]
[[durable_objects.bindings]]
name = "DECO_CHAT_WORKFLOW_DO"
class_name = "Workflow"
```

<Callout type="info">
  Integrações adicionadas via `deco add` atualizam automaticamente este arquivo.
</Callout>

## View (`/view`)

O diretório view contém um app React construído com Vite e TanStack Router.

### Estrutura do App

```
view/src/
├── main.tsx            # App entry point with router setup
├── routes/             # Page components
│   ├── home.tsx       # Homepage route
│   └── profile.tsx    # Profile route
├── components/         # Reusable UI components
│   ├── ui/            # shadcn/ui components
│   └── error-boundary.tsx
├── lib/               # Utilities and RPC client
│   ├── rpc.ts         # Typed RPC client for calling tools
│   ├── hooks.ts       # Custom React hooks
│   └── utils.ts       # Utility functions
└── styles.css         # Tailwind CSS styles
```

### Cliente RPC

Chame suas tools backend com total segurança de tipos:

```typescript
// view/src/lib/rpc.ts
import { createClient } from "@deco/workers-runtime/client";
import type { Env } from "../../server/deco.gen.ts";

type SelfMCP = Env["SELF"];
export const client = createClient<SelfMCP>();
```

### Componentes de Rota

Crie páginas usando TanStack Router:

```typescript
// view/src/routes/home.tsx
import { createRoute } from "@tanstack/react-router";
import { client } from "../lib/rpc";

export default (parentRoute) => createRoute({
  getParentRoute: () => parentRoute,
  path: "/",
  component: HomePage,
});

function HomePage() {
  const handleListTodos = async () => {
    const todos = await client.tools.LIST_TODOS({});
    console.log(todos);
  };

  return (
    <div>
      <h1>My App</h1>
      <button onClick={handleListTodos}>Load Todos</button>
    </div>
  );
}
```


### O que é Deployado

- **Servidor MCP**: Disponível no endpoint `/mcp` para agentes de IA
- **App React**: Interface web pública para suas tools
- **Banco de Dados**: Banco SQLite com dados isolados do workspace  
- **Integrações**: Tokens OAuth e credenciais de API (criptografadas)

<Callout type="warning">
  Apps React são públicos por padrão. Adicione autenticação para funcionalidades privadas.
</Callout>

