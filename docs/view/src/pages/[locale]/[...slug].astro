---
import { useTranslations } from '../../i18n/utils';
import { ui, languages } from '../../i18n/ui';
import HomeLayout from "../../layouts/HomeLayout.astro";
import DocsLayout from "../../layouts/DocsLayout.astro";
import Home from '../../components/Home.astro';
import { getCollection } from "astro:content";
import RenderDocument from '../../components/RenderDocument.astro';

const lang = Astro.params.locale;
const t = useTranslations(lang as keyof typeof ui);

export async function getStaticPaths() {
  const allDocs = await getCollection("docs");

  return [
    ...Object.keys(languages).map((locale) => ({
      params: { locale },
      props: { doc: null },
    })),
    ...allDocs.map((doc) => {
      const locale = doc.id.split("/")[0];
      const slug = doc.id.split("/").slice(1).join("/");

      return {
        params: { locale, slug },
        props: { doc },
      }
    }),
  ];
}

const { doc } = Astro.props;
---

{!doc ? (
  <HomeLayout title={t('head.title')}>
      <Home />
  </HomeLayout>
) : (
  <DocsLayout title={doc.data.title}>
    <RenderDocument doc={doc} />
  </DocsLayout>
)}